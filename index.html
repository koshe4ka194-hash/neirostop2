<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuro-Pause Engine</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: transparent !important; display: flex; align-items: center; justify-content: center; }
        #modal { display: none; position: fixed; inset: 0; align-items: center; justify-content: center; z-index: 9999; background: transparent; }
        #modal.active { display: flex; }
        .card { background: white; padding: 25px; border-radius: 35px; text-align: center; width: 280px; box-shadow: 0 15px 50px rgba(0,0,0,0.15); border: 2px solid #2dd4bf; box-sizing: border-box; }
        .icon { font-size: 45px; margin-bottom: 10px; display: block; }
        .img-content { width: 100%; border-radius: 20px; margin-bottom: 15px; display: none; }
        .title { font-weight: 800; font-size: 20px; color: #134e4a; margin-bottom: 15px; }
        .task { background: #f0fdfa; padding: 15px; border-radius: 20px; font-size: 16px; color: #1e293b; border: 1px dashed #2dd4bf; margin-bottom: 15px; line-height: 1.4; }
        .timer { width: 50px; height: 50px; background: #2dd4bf; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; margin: 0 auto; }
        .btn { background: #fbbf24; color: #78350f; border: none; padding: 15px; border-radius: 18px; font-size: 16px; font-weight: 900; cursor: pointer; width: 100%; display: none; box-shadow: 0 3px 0 #d97706; }
    </style>
</head>
<body>

<div id="modal">
    <div class="card">
        <span id="ci" class="icon"></span>
        <img id="cimg" class="img-content" src="">
        <div id="ctitle" class="title"></div>
        <div id="ctext" class="task"></div>
        <div id="ctimer" class="timer"></div>
        <button id="cbtn" class="btn"></button>
    </div>
</div>

<script>
    (function() {
        const urlParams = new URLSearchParams(window.location.search);
        
        // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¸Ð· ÑÑÑ‹Ð»ÐºÐ¸ Ð¸Ð»Ð¸ ÑÑ‚Ð°Ð²Ð¸Ð¼ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ðµ
        const workMin = parseInt(urlParams.get('w')) || 12;
        const pauseSec = parseInt(urlParams.get('p')) || 30;
        const font = urlParams.get('f') || 'sans-serif';
        const lang = urlParams.get('l') || 'RU';
        const tasksRaw = urlParams.get('t') ? decodeURIComponent(urlParams.get('t')).split(';') : [];

        // ÐŸÑ€Ð¸Ð¼ÐµÐ½ÑÐµÐ¼ ÑˆÑ€Ð¸Ñ„Ñ‚
        if (font === 'OpenDyslexic') {
            const style = document.createElement('style');
            style.innerHTML = "@font-face { font-family: 'OpenDyslexic'; src: url('https://cdn.jsdelivr.net/npm/opendyslexic@1.0.3/OpenDyslexic-Regular.otf'); } body { font-family: 'OpenDyslexic', sans-serif !important; }";
            document.head.appendChild(style);
        } else {
            document.body.style.fontFamily = font + ', sans-serif';
        }

        // Ð›Ð¾ÐºÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ
        const i18n = {
            RU: { h: "ÐœÐ¸Ð½ÑƒÑ‚ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ñ‹", b: "Ð“ÐžÐ¢ÐžÐ’Ðž! âœ¨" },
            EN: { h: "Mindful Break", b: "DONE! âœ¨" },
            DE: { h: "Kleine Pause", b: "FERTIG! âœ¨" },
            CN: { h: "ä¼‘æ¯æ—¶é—´", b: "å®Œæˆ! âœ¨" }
        };
        const text = i18n[lang] || i18n.RU;
        document.getElementById('ctitle').innerText = text.h;
        document.getElementById('cbtn').innerText = text.b;

        // Ð¢Ð°Ð¹Ð¼ÐµÑ€ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ
        const workMs = workMin * 60 * 1000;
        let targetTime = Date.now() + workMs;

        try {
            const saved = localStorage.getItem('neuro_target');
            if (saved && parseInt(saved) > Date.now()) {
                targetTime = parseInt(saved);
            } else {
                localStorage.setItem('neuro_target', targetTime);
            }
        } catch(e) {}

        const mainTimer = setInterval(() => {
            if (Date.now() >= targetTime) {
                clearInterval(mainTimer);
                showPause();
            }
        }, 1000);

        function showPause() {
            // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ð¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ
            if (tasksRaw.length > 0) {
                const randomTask = tasksRaw[Math.floor(Math.random() * tasksRaw.length)];
                const [icon, content] = randomTask.split('|').map(s => s.trim());
                
                document.getElementById('ci').innerText = icon || 'ðŸ§˜';
                
                if (content && content.startsWith('http')) {
                    document.getElementById('cimg').src = content;
                    document.getElementById('cimg').style.display = 'block';
                    document.getElementById('ctext').style.display = 'none';
                } else {
                    document.getElementById('ctext').innerText = content || 'Ð¡Ð´ÐµÐ»Ð°Ð¹Ñ‚Ðµ Ð¿Ð°ÑƒÐ·Ñƒ';
                    document.getElementById('cimg').style.display = 'none';
                    document.getElementById('ctext').style.display = 'block';
                }
            }

            document.getElementById('modal').classList.add('active');
            
            let left = pauseSec;
            document.getElementById('ctimer').innerText = left;
            
            const pTimer = setInterval(() => {
                left--;
                document.getElementById('ctimer').innerText = left;
                if (left <= 0) {
                    clearInterval(pTimer);
                    document.getElementById('ctimer').style.display = 'none';
                    document.getElementById('cbtn').style.display = 'block';
                }
            }, 1000);
        }

        document.getElementById('cbtn').onclick = () => {
            localStorage.removeItem('neuro_target');
            location.reload();
        };
    })();
</script>
</body>
</html>
